<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Reshape Disorganised Messy Data • tabshiftr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Reshape Disorganised Messy Data">
<meta property="og:description" content="Helps the user to build and register schema descriptions of disorganised (messy) tables. Disorganised tables are tables that are not in a topologically coherent form, where packages such as tidyr could be used for reshaping. The schema description documents the arrangement of input tables and is used to reshape them into a standardised (tidy) output format.">
<meta property="og:image" content="http://EhrmannS.github.io/tabshiftr/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">tabshiftr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.5.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/tabshiftr.html">Get Started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="http://www.twitter.com/DerEhrmann" class="external-link">
    <span class="fa fa-twitter fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/EhrmannS/tabshiftr" class="external-link">
    <span class="fa fa-github"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">

<div class="section level1">
<div class="page-header"><h1 id="tabshiftr-">tabshiftr <a href="https://luckinet.github.io/tabshiftr/" class="external-link"><img src="reference/figures/logo.svg" align="right" height="200"></a>
<a class="anchor" aria-label="anchor" href="#tabshiftr-"></a>
</h1></div>
<p><a href="https://cran.r-project.org/package=tabshiftr" class="external-link"><img src="http://www.r-pkg.org/badges/version/tabshiftr" alt="CRAN_Status_Badge"></a> <a href="https://zenodo.org/badge/latestdoi/248468235" class="external-link"><img src="https://zenodo.org/badge/248468235.svg" alt="DOI"></a></p>
<p><a href="https://github.com/luckinet/tabshiftr/actions" class="external-link"><img src="https://github.com/luckinet/tabshiftr/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a> <a href="https://codecov.io/gh/luckinet/tabshiftr" class="external-link"><img src="https://codecov.io/gh/luckinet/tabshiftr/branch/master/graph/badge.svg?token=hjppymcGr3" alt="codecov"></a> <a href="https://lifecycle.r-lib.org/articles/stages.html" class="external-link"><img src="https://img.shields.io/badge/lifecycle-maturing-blue.svg" alt="Lifecycle:maturing"></a></p>
<p><a href="https://cran.r-project.org/package=tabshiftr" class="external-link"><img src="http://cranlogs.r-pkg.org/badges/grand-total/tabshiftr"></a></p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Data are stored in many different ways in tables or spreadsheets because no strict semantic or topographic standards for the organisation of tables are commonly accepted. In the R environment the <em>tidy</em> paradigm is a first step towards interoperability of data, in that it requires a certain arrangement of tables, where variables are recorded in columns and observations in rows (see <a href="https://tidyr.tidyverse.org/" class="external-link uri">https://tidyr.tidyverse.org/</a>). Tables can be tidied (i.e., brought into a tidy arrangement) via packages such as <code>tidyr</code>, however, all functions that deal with reshaping tables to date require data that are already organised into topologically coherent, rectangular tables. This is often violated in practice, especially in data that are scraped off of the internet.</p>
<p><code>tabshiftr</code> fills this gap in the toolchain towards more interoperable data via <code>schema</code> descriptions that are built with setters and debugged with getters and a <code><a href="reference/reorganise.html">reorganise()</a></code> function that ties everything together.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Install the official version from CRAN:</li>
</ol>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"tabshiftr"</span><span class="op">)</span></span></code></pre></div>
<p>or the latest development version from github:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"luckinet/tabshiftr"</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>The <a href="https://luckinet.github.io/tabshiftr/articles/tabshiftr.html" class="external-link">vignette</a>
</li>
</ol>
<ul>
<li>gives an introduction of the nature of tabular data and of the dimensions of disorganization dealt with here,</li>
<li>provides an instruction on how to set up a schema description</li>
<li>shows a wide range of table arrangements that can be reshaped with the tools provided here.</li>
</ul>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<p>A disorganized table may look like the following table:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://luckinet.github.io/tabshiftr/" class="external-link">tabshiftr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://yihui.org/knitr/" class="external-link">knitr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># a rather disorganized table with messy clusters and a distinct variable</span></span>
<span><span class="va">input</span> <span class="op">&lt;-</span> <span class="va">tabs2shift</span><span class="op">$</span><span class="va">clusters_messy</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">input</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="16%">
<col width="13%">
<col width="15%">
<col width="16%">
<col width="13%">
<col width="15%">
<col width="10%">
</colgroup>
<thead><tr class="header">
<th align="left">X1</th>
<th align="left">X2</th>
<th align="left">X3</th>
<th align="left">X4</th>
<th align="left">X5</th>
<th align="left">X6</th>
<th align="left">X7</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">commodities</td>
<td align="left">harvested</td>
<td align="left">production</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">unit 1</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">soybean</td>
<td align="left">1111</td>
<td align="left">1112</td>
<td align="left">year 1</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">maize</td>
<td align="left">1121</td>
<td align="left">1122</td>
<td align="left">year 1</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">soybean</td>
<td align="left">1211</td>
<td align="left">1212</td>
<td align="left">year 2</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">maize</td>
<td align="left">1221</td>
<td align="left">1222</td>
<td align="left">year 2</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">commodities</td>
<td align="left">harvested</td>
<td align="left">production</td>
<td align="left">commodities</td>
<td align="left">harvested</td>
<td align="left">production</td>
<td align="left">.</td>
</tr>
<tr class="odd">
<td align="left">unit 2</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">unit 3</td>
<td align="left">.</td>
<td align="left">.</td>
<td align="left">.</td>
</tr>
<tr class="even">
<td align="left">soybean</td>
<td align="left">2111</td>
<td align="left">2112</td>
<td align="left">soybean</td>
<td align="left">3111</td>
<td align="left">3112</td>
<td align="left">year 1</td>
</tr>
<tr class="odd">
<td align="left">maize</td>
<td align="left">2121</td>
<td align="left">2122</td>
<td align="left">maize</td>
<td align="left">3121</td>
<td align="left">3122</td>
<td align="left">year 1</td>
</tr>
<tr class="even">
<td align="left">soybean</td>
<td align="left">2211</td>
<td align="left">2212</td>
<td align="left">soybean</td>
<td align="left">3211</td>
<td align="left">3212</td>
<td align="left">year 2</td>
</tr>
<tr class="odd">
<td align="left">maize</td>
<td align="left">2221</td>
<td align="left">2222</td>
<td align="left">maize</td>
<td align="left">3221</td>
<td align="left">3222</td>
<td align="left">year 2</td>
</tr>
</tbody>
</table>
<p>If we were to transform this data into tidy data by merely using the functions in <code>tidyr</code> (or the extended <code>tidyverse</code> in general), we’d potentially end up with a massive algorithm, especially for such complicated table arrangements. For other tables that may or may not be as complicated, we’d have to set up yet more algorithms and while a pipeline of tidy functions is relatively easy to set up, it would still become very laborious to repeat this for the dozens of potential table arrangements. In <code>tabshiftr</code> we solve that by describing the schema of the input table and providing this schema description to the <code><a href="reference/reorganise.html">reorganise()</a></code> function. This requires us to use a vastly smaller set of code and makes it thus a lot more efficient to bring multiple heterogeneous data into an interoperable format.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># put together schema description by ...</span></span>
<span><span class="co"># ... identifying cluster positions</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/setCluster.html">setCluster</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"territories"</span>, left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, top <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... specifying the cluster ID as id variable (obligatory for when we deal with clusters)</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="reference/setIDVar.html">setIDVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"territories"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">9</span>, <span class="fl">9</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... specifying a distinct variable (explicit position)</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="reference/setIDVar.html">setIDVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"year"</span>, columns <span class="op">=</span> <span class="fl">4</span>, rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, distinct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... specifying a tidy identifying variable (by giving the column values)</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="reference/setIDVar.html">setIDVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"commodities"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... identifying the (tidy) observed variables</span></span>
<span><span class="va">schema</span> <span class="op">&lt;-</span> <span class="va">schema</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="reference/setObsVar.html">setObsVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"harvested"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span>, <span class="fl">5</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>   <span class="fu"><a href="reference/setObsVar.html">setObsVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"production"</span>, columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">3</span>, <span class="fl">6</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># to potentially debug the schema description, first validate the schema ...</span></span>
<span><span class="va">schema_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/validateSchema.html">validateSchema</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="va">schema</span>, input <span class="op">=</span> <span class="va">input</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># ... and extract parts of it per cluster (also check out the other getters in</span></span>
<span><span class="co"># this package)</span></span>
<span><span class="fu"><a href="reference/getIDVars.html">getIDVars</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="va">schema_valid</span>, input <span class="op">=</span> <span class="va">input</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$year</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X4    </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 year 1</span></span>
<span><span class="co">#&gt; 2 year 1</span></span>
<span><span class="co">#&gt; 3 year 2</span></span>
<span><span class="co">#&gt; 4 year 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$commodities</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X1     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 soybean</span></span>
<span><span class="co">#&gt; 2 maize  </span></span>
<span><span class="co">#&gt; 3 soybean</span></span>
<span><span class="co">#&gt; 4 maize  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$year</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X4    </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 year 1</span></span>
<span><span class="co">#&gt; 2 year 1</span></span>
<span><span class="co">#&gt; 3 year 2</span></span>
<span><span class="co">#&gt; 4 year 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$commodities</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X1     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 soybean</span></span>
<span><span class="co">#&gt; 2 maize  </span></span>
<span><span class="co">#&gt; 3 soybean</span></span>
<span><span class="co">#&gt; 4 maize  </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [[3]]$year</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X4    </span></span>
<span><span class="co">#&gt;   &lt;chr&gt; </span></span>
<span><span class="co">#&gt; 1 year 1</span></span>
<span><span class="co">#&gt; 2 year 1</span></span>
<span><span class="co">#&gt; 3 year 2</span></span>
<span><span class="co">#&gt; 4 year 2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$commodities</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X4     </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;  </span></span>
<span><span class="co">#&gt; 1 soybean</span></span>
<span><span class="co">#&gt; 2 maize  </span></span>
<span><span class="co">#&gt; 3 soybean</span></span>
<span><span class="co">#&gt; 4 maize</span></span>
<span><span class="fu"><a href="reference/getObsVars.html">getObsVars</a></span><span class="op">(</span>schema <span class="op">=</span> <span class="va">schema_valid</span>, input <span class="op">=</span> <span class="va">input</span><span class="op">)</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [[1]]$harvested</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X2   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1111 </span></span>
<span><span class="co">#&gt; 2 1121 </span></span>
<span><span class="co">#&gt; 3 1211 </span></span>
<span><span class="co">#&gt; 4 1221 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[1]]$production</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X3   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 1112 </span></span>
<span><span class="co">#&gt; 2 1122 </span></span>
<span><span class="co">#&gt; 3 1212 </span></span>
<span><span class="co">#&gt; 4 1222 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [[2]]$harvested</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X2   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 2111 </span></span>
<span><span class="co">#&gt; 2 2121 </span></span>
<span><span class="co">#&gt; 3 2211 </span></span>
<span><span class="co">#&gt; 4 2221 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]$production</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X3   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 2112 </span></span>
<span><span class="co">#&gt; 2 2122 </span></span>
<span><span class="co">#&gt; 3 2212 </span></span>
<span><span class="co">#&gt; 4 2222 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [[3]]$harvested</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X5   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 3111 </span></span>
<span><span class="co">#&gt; 2 3121 </span></span>
<span><span class="co">#&gt; 3 3211 </span></span>
<span><span class="co">#&gt; 4 3221 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]$production</span></span>
<span><span class="co">#&gt; # A tibble: 4 × 1</span></span>
<span><span class="co">#&gt;   X6   </span></span>
<span><span class="co">#&gt;   &lt;chr&gt;</span></span>
<span><span class="co">#&gt; 1 3112 </span></span>
<span><span class="co">#&gt; 2 3122 </span></span>
<span><span class="co">#&gt; 3 3212 </span></span>
<span><span class="co">#&gt; 4 3222</span></span>
<span></span>
<span><span class="co"># alternatively, if the clusters are regular, relative values starting from the</span></span>
<span><span class="co"># cluster origin could be set</span></span>
<span><span class="va">schema_alt</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/setCluster.html">setCluster</a></span><span class="op">(</span>id <span class="op">=</span> <span class="st">"territories"</span>,</span>
<span>                         left <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">4</span><span class="op">)</span>, top <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">8</span>, <span class="fl">8</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/setIDVar.html">setIDVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"territories"</span>, columns <span class="op">=</span> <span class="fl">1</span>, rows <span class="op">=</span> <span class="fu"><a href="reference/dot-find.html">.find</a></span><span class="op">(</span>row <span class="op">=</span> <span class="fl">2</span>, relative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/setIDVar.html">setIDVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"year"</span>, columns <span class="op">=</span> <span class="fl">4</span>, rows <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span><span class="op">:</span><span class="fl">6</span><span class="op">)</span>, distinct <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/setIDVar.html">setIDVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"commodities"</span>, columns <span class="op">=</span> <span class="fu"><a href="reference/dot-find.html">.find</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">1</span>, relative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/setObsVar.html">setObsVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"harvested"</span>, columns <span class="op">=</span> <span class="fu"><a href="reference/dot-find.html">.find</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">2</span>, relative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="reference/setObsVar.html">setObsVar</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"production"</span>, columns <span class="op">=</span> <span class="fu"><a href="reference/dot-find.html">.find</a></span><span class="op">(</span>col <span class="op">=</span> <span class="fl">3</span>, relative <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The <code><a href="reference/reorganise.html">reorganise()</a></code> function carries out the steps of validating, extracting the variables, pivoting the tentative output and putting the final table together automatically, so it merely requires the finalised <code>schema</code> and the <code>input</code> table.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">schema</span> <span class="co"># has a pretty print function</span></span>
<span><span class="co">#&gt;   3 clusters</span></span>
<span><span class="co">#&gt;     origin : 1|1, 8|1, 8|4  (row|col)</span></span>
<span><span class="co">#&gt;     id     : territories</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;    variable      type       row    col    dist </span></span>
<span><span class="co">#&gt;   ------------- ---------- ------ ------ ------  </span></span>
<span><span class="co">#&gt;    territories   id         2, 9   1, 4   F  </span></span>
<span><span class="co">#&gt;    year          id         3:6    4      T  </span></span>
<span><span class="co">#&gt;    commodities   id                1, 4   F  </span></span>
<span><span class="co">#&gt;    harvested     observed          2, 5   F  </span></span>
<span><span class="co">#&gt;    production    observed          3, 6   F</span></span>
<span></span>
<span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/reorganise.html">reorganise</a></span><span class="op">(</span>input <span class="op">=</span> <span class="va">input</span>, schema <span class="op">=</span> <span class="va">schema</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">territories</th>
<th align="left">year</th>
<th align="left">commodities</th>
<th align="right">harvested</th>
<th align="right">production</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">unit 1</td>
<td align="left">year 1</td>
<td align="left">soybean</td>
<td align="right">1111</td>
<td align="right">1112</td>
</tr>
<tr class="even">
<td align="left">unit 1</td>
<td align="left">year 1</td>
<td align="left">maize</td>
<td align="right">1121</td>
<td align="right">1122</td>
</tr>
<tr class="odd">
<td align="left">unit 1</td>
<td align="left">year 2</td>
<td align="left">soybean</td>
<td align="right">1211</td>
<td align="right">1212</td>
</tr>
<tr class="even">
<td align="left">unit 1</td>
<td align="left">year 2</td>
<td align="left">maize</td>
<td align="right">1221</td>
<td align="right">1222</td>
</tr>
<tr class="odd">
<td align="left">unit 2</td>
<td align="left">year 1</td>
<td align="left">soybean</td>
<td align="right">2111</td>
<td align="right">2112</td>
</tr>
<tr class="even">
<td align="left">unit 2</td>
<td align="left">year 1</td>
<td align="left">maize</td>
<td align="right">2121</td>
<td align="right">2122</td>
</tr>
<tr class="odd">
<td align="left">unit 2</td>
<td align="left">year 2</td>
<td align="left">soybean</td>
<td align="right">2211</td>
<td align="right">2212</td>
</tr>
<tr class="even">
<td align="left">unit 2</td>
<td align="left">year 2</td>
<td align="left">maize</td>
<td align="right">2221</td>
<td align="right">2222</td>
</tr>
<tr class="odd">
<td align="left">unit 3</td>
<td align="left">year 1</td>
<td align="left">soybean</td>
<td align="right">3111</td>
<td align="right">3112</td>
</tr>
<tr class="even">
<td align="left">unit 3</td>
<td align="left">year 1</td>
<td align="left">maize</td>
<td align="right">3121</td>
<td align="right">3122</td>
</tr>
<tr class="odd">
<td align="left">unit 3</td>
<td align="left">year 2</td>
<td align="left">soybean</td>
<td align="right">3211</td>
<td align="right">3212</td>
</tr>
<tr class="even">
<td align="left">unit 3</td>
<td align="left">year 2</td>
<td align="left">maize</td>
<td align="right">3221</td>
<td align="right">3222</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level1">
<h1 id="contributions">Contributions<a class="anchor" aria-label="anchor" href="#contributions"></a>
</h1>
<ul>
<li>tabshiftr is still in development. So far it reliably reorganizes 20 different types of tables, but additional dimensions of disorganization might show themselves. If you encounter a table that can’t be reorganized with the current infrastructure, we’d be more than happy to collaborate on advancing <code>tabshiftr</code>.</li>
<li>Informative error management is work in process.</li>
<li>Moreover, the resulting schema descriptions can be useful for data archiving or database building and <code>tabshiftr</code> should at some point support that those schemas can be exported into data-formats that are used by downstream applications (xml, json, …), following proper (ISO) standards. In case you have experience with those standards and would like to collaborate on it, please get in touch!</li>
</ul>
</div>
<div class="section level1">
<h1 id="acknowledgement">Acknowledgement<a class="anchor" aria-label="anchor" href="#acknowledgement"></a>
</h1>
<p>This work was supported by funding to Carsten Meyer through the Flexpool mechanism of the German Centre for Integrative Biodiversity Research (iDiv) (FZT-118, DFG).</p>
</div>

  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=tabshiftr" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/luckinet/tabshiftr/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/luckinet/tabshiftr/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing tabshiftr</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://orcid.org/0000-0002-2958-0796" class="external-link">Steffen Ehrmann</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0002-2958-0796" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>
<a href="https://orcid.org/0000-0003-3927-5856" class="external-link">Carsten Meyer</a> <br><small class="roles"> Author </small> <a href="https://orcid.org/0000-0003-3927-5856" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li><a href="authors.html">More about authors...</a></li>
</ul>
</div>



  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://orcid.org/0000-0002-2958-0796" class="external-link">Steffen Ehrmann</a>, <a href="https://orcid.org/0000-0003-3927-5856" class="external-link">Carsten Meyer</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.9.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
